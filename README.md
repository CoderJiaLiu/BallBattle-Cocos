# BallBattle

使用 LeanCloud Play 服务模拟的《球球大作战》demo。
主要体现由 Client 控制游戏逻辑的开发方式，即 Master Client。

## 玩法

输入房间 ID，加入房间（如果没有此房间，则创建）。用户 ID 随机生成。
使用 ⬆️⬇️⬅️➡️ 或 WSAD 来控制小球移动，吃掉场景中的食物（三角形，方形，六边形）则会增长体重（并减少速度）；遇到其他球（玩家），碰撞之后，体重较大者获胜，较小者将会死亡并重生。
右侧面板显示当前房间的玩家体重排行榜。

## 设计思路

Battle 类，用于接收战斗中的自定义消息，根据消息解析，驱动场景节点及 UI 节点变化。
Master 类，用于区分 Master 客户端与普通客户端，Master 组件用于生成房间数据及逻辑判断，只有 Master 的客户端才拥有这个组件，包括最初的房间的创建者和切换后的新房主。
BallController 和 BallSimulator 类，用于区分本地客户端与其他客户端。BallController 用于玩家控制，并生成移动数据同步给其他客户端；BallSimulator 用于根据同步得到的玩家移动数据，模拟运动行为。

## 主要实现功能

### 匹配对战

最基础的房间 ID 匹配。

### 消息处理控制

由于从主场景加载到战斗场景，存在异步的资源加载过程，所以需要暂停 / 恢复消息队列的处理。
即 加入房间 -> 暂停消息处理 -> 加载战斗场景 -> 初始化战场 -> 恢复消息队列。

### 房间数据同步与保存

这个 demo 使用的是 Master Client 机制，但由于 Master Client 可能存在掉线等异常情况，所以需要将房间和玩家的部分数据保存至 Room Properties 和 Player Properties。

#### Room Properties

房间用时；战场的食物列表；食物最大 ID。

#### Player Properties

位置；体重；速度。

### 自定义消息

玩家出生；吃食物；杀死玩家；玩家离开；玩家重生；生成食物；游戏结束。
